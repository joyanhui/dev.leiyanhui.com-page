<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Archlinux on 小类随手记</title><link>https://dev.leiyanhui.com/categories/archlinux/</link><description>Recent content in Archlinux on 小类随手记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 21 Nov 2022 19:16:20 +0800</lastBuildDate><atom:link href="https://dev.leiyanhui.com/categories/archlinux/index.xml" rel="self" type="application/rss+xml"/><item><title>关闭核显直通，打开vgpu，多虚拟机同时使用核显.kvm下一个核显和多个虚拟机共享使用3D加速甚至游戏</title><link>https://dev.leiyanhui.com/kvm/gvt-g-vgpu/</link><pubDate>Mon, 21 Nov 2022 19:16:20 +0800</pubDate><guid>https://dev.leiyanhui.com/kvm/gvt-g-vgpu/</guid><description>&lt;p&gt;和pci直通相比，gvt-g可以吧同一个显卡 同时共享给多个虚拟机使用，并提供硬件加速。&lt;/p&gt;
&lt;h2 id="前置条件"&gt;前置条件
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;已经安装了一个 kvm &lt;a class="link" href="https://dev.leiyanhui.com/kvm/arch-install-kvm/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/arch-install-kvm/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;开启了核显直通 &lt;a class="link" href="https://dev.leiyanhui.com/kvm/pci-usb/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/pci-usb/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="处理一些简单的操作"&gt;处理一些简单的操作
&lt;/h2&gt;&lt;p&gt;删除核显的vfio绑定&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo nano /etc/modprobe.d/vfio.conf
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;删除
sudo nano /etc/mkinitcpio.conf
删除一些配置文件&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; sudo rm -rf /etc/modprobe.d/blacklist.conf
sudo rm -rf /etc/booster.yaml
sudo rm -rf /etc/dracut.conf.d
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id="i915enable_guc0"&gt;i915.enable_guc=0
&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;sudo nano /etc/default/grub
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;GRUB_CMDLINE_LINUX_DEFAULT 这行 编辑一下 确保有&lt;code&gt;intel_iommu=on i915.enable_guc=0&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="重启"&gt;重启
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;# pve =&amp;gt; update-initramfs -u
sudo update-grub
sudo mkinitcpio -P
sudo reboot
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="开启kernel的几个-modules"&gt;开启kernel的几个 modules
&lt;/h2&gt;&lt;p&gt;kernel modules: kvmgt, vfio-iommu-type1 and mdev.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo modprobe kvmgt vfio-iommu-type1 mdev
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="配置-i915--enable_gvt1"&gt;配置 i915 enable_gvt=1
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;sudo echo &amp;quot;options i915 enable_gvt=1&amp;quot; &amp;gt;&amp;gt; /etc/modprobe.d/gvt-g.conf
#重启
sudo mkinitcpio -P
sudo reboot
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="重启后查看显卡"&gt;重启后查看显卡
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;lspci -D -nn # 查看id 核显一般情况是 0000:00:02.0
#查看模式
ls /sys/devices/pci0000:00/0000:00:02.0/mdev_supported_types
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;未完成待续&lt;/p&gt;
&lt;p&gt;参考 &lt;a class="link" href="https://www.cnblogs.com/kagamirr/p/15451409.html" target="_blank" rel="noopener"
&gt;https://www.cnblogs.com/kagamirr/p/15451409.html&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="我的kvm脚本参考"&gt;我的kvm脚本参考
&lt;/h3&gt;&lt;p&gt;&lt;a class="link" href="https://github.com/joyanhui/file.leiyanhui.com/tree/main/pve-unraid-kvm" target="_blank" rel="noopener"
&gt;https://github.com/joyanhui/file.leiyanhui.com/tree/main/pve-unraid-kvm&lt;/a&gt;&lt;/p&gt;</description></item><item><title>kvm 进阶和相关小问题处理</title><link>https://dev.leiyanhui.com/kvm/all_list/</link><pubDate>Mon, 07 Nov 2022 00:19:20 +0800</pubDate><guid>https://dev.leiyanhui.com/kvm/all_list/</guid><description>&lt;h2 id="进阶功能和相关记录文章"&gt;进阶功能和相关记录文章
&lt;/h2&gt;&lt;h3 id="基本安装"&gt;基本安装
&lt;/h3&gt;&lt;p&gt;查看这里： &lt;a class="link" href="https://dev.leiyanhui.com/arch/install-kvm/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/arch/install-kvm/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="关于efi-ovmf模式启动"&gt;关于efi ovmf模式启动
&lt;/h3&gt;&lt;p&gt;查看这里： &lt;a class="link" href="https://dev.leiyanhui.com/kvm/ovmf/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/ovmf/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="进阶配置桥接网络"&gt;进阶：配置桥接网络
&lt;/h3&gt;&lt;p&gt;桥接网络：&lt;a class="link" href="https://dev.leiyanhui.com/kvm/net-br/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/net-br/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="硬件直通--pci-和usb"&gt;硬件直通 pci 和usb
&lt;/h3&gt;&lt;p&gt;查看这里 &lt;a class="link" href="https://dev.leiyanhui.com/kvm/pci-usb/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/pci-usb/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="声卡的直通穿透"&gt;声卡的直通/穿透
&lt;/h3&gt;&lt;p&gt;查看这里 &lt;a class="link" href="https://dev.leiyanhui.com/kvm/sound-pass/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/sound-pass/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="我的一些配置文件记录"&gt;我的一些配置文件记录
&lt;/h3&gt;&lt;p&gt;查看这里 &lt;a class="link" href="https://github.com/joyanhui/file.leiyanhui.com/tree/main/pve-unraid-kvm" target="_blank" rel="noopener"
&gt;https://github.com/joyanhui/file.leiyanhui.com/tree/main/pve-unraid-kvm&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="kvm-开机自动启动"&gt;kvm 开机自动启动
&lt;/h3&gt;&lt;p&gt;查看这里 &lt;a class="link" href="https://dev.leiyanhui.com/kvm/auto_start_vm/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/auto_start_vm/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="kvm-过游戏检测和部分显卡驱动无法安装"&gt;kvm 过游戏检测和部分显卡驱动无法安装
&lt;/h3&gt;&lt;p&gt;查看这里 &lt;a class="link" href="https://dev.leiyanhui.com/kvm/guest-unkvm/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/guest-unkvm/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="kvm安装macos"&gt;kvm安装macos
&lt;/h3&gt;&lt;p&gt;查看这里：&lt;a class="link" href="https://dev.leiyanhui.com/kvm/install-macos-base/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/install-macos-base/&lt;/a&gt;&lt;/p&gt;
&lt;h4 id="kvm安装macos附加上一个win"&gt;kvm安装macos附加上一个win
&lt;/h4&gt;&lt;p&gt;查看这里：&lt;a class="link" href="https://dev.leiyanhui.com/kvm/macos_add_win10/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/macos_add_win10/&lt;/a&gt;&lt;/p&gt;
&lt;h4 id="kvm虚拟机和宿主机文件交换"&gt;kvm虚拟机和宿主机文件交换
&lt;/h4&gt;&lt;p&gt;查看这里：&lt;a class="link" href="https://dev.leiyanhui.com/kvm/syncfile/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/syncfile/&lt;/a&gt;&lt;/p&gt;
&lt;h4 id="kvm-shell启动权限问题"&gt;kvm shell启动权限问题
&lt;/h4&gt;&lt;p&gt;查看这里：&lt;a class="link" href="https://dev.leiyanhui.com/kvm/shell_sudo/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/shell_sudo/&lt;/a&gt;&lt;/p&gt;</description></item><item><title>kvm 自动启动vm，不使用libvirt</title><link>https://dev.leiyanhui.com/kvm/auto_start_vm/</link><pubDate>Tue, 01 Nov 2022 02:03:20 +0800</pubDate><guid>https://dev.leiyanhui.com/kvm/auto_start_vm/</guid><description>&lt;blockquote&gt;
&lt;p&gt;不想使用libvirt 因为占用50M硬盘，然后只是提供一个简单管理功能。有洁癖不喜欢。 而且徒增学习成本&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;所以需要手动处理自动启动脚本&lt;/p&gt;
&lt;p&gt;我这里是用的archlinux，所以 就自己创建一个脚本了。&lt;/p&gt;
&lt;p&gt;也很简单 用 systemctl 创建一个服务就ok了， &lt;a class="link" href="https://dev.leiyanhui.com/arch/autostar/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/arch/autostar/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="进阶功能和相关记录文章"&gt;进阶功能和相关记录文章
&lt;/h2&gt;&lt;h3 id="基本安装"&gt;基本安装
&lt;/h3&gt;&lt;p&gt;查看这里： &lt;a class="link" href="https://dev.leiyanhui.com/arch/install-kvm/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/arch/install-kvm/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="关于efi模式启动"&gt;关于efi模式启动
&lt;/h3&gt;&lt;p&gt;查看这里： &lt;a class="link" href="https://dev.leiyanhui.com/kvm/ovmf/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/ovmf/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="进阶配置桥接网络"&gt;进阶：配置桥接网络
&lt;/h3&gt;&lt;p&gt;桥接网络：&lt;a class="link" href="https://dev.leiyanhui.com/kvm/net-br/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/net-br/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="硬件直通--pci-和usb"&gt;硬件直通 pci 和usb
&lt;/h3&gt;&lt;p&gt;查看这里 &lt;a class="link" href="https://dev.leiyanhui.com/kvm/pci-usb/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/pci-usb/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="声卡的直通穿透"&gt;声卡的直通/穿透
&lt;/h3&gt;&lt;p&gt;查看这里 &lt;a class="link" href="https://dev.leiyanhui.com/kvm/sound-pass/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/sound-pass/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="我的一些配置文件记录"&gt;我的一些配置文件记录
&lt;/h3&gt;&lt;p&gt;查看这里 &lt;a class="link" href="https://github.com/joyanhui/file.leiyanhui.com/tree/main/pve-unraid-kvm" target="_blank" rel="noopener"
&gt;https://github.com/joyanhui/file.leiyanhui.com/tree/main/pve-unraid-kvm&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="kvm-开机自动启动"&gt;kvm 开机自动启动
&lt;/h3&gt;&lt;p&gt;查看这里 &lt;a class="link" href="https://dev.leiyanhui.com/kvm/auto_start_vm/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/auto_start_vm/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="kvm安装macos"&gt;kvm安装macos
&lt;/h3&gt;&lt;p&gt;查看这里：&lt;a class="link" href="https://dev.leiyanhui.com/kvm/install-macos-base/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/install-macos-base/&lt;/a&gt;&lt;/p&gt;
&lt;h4 id="kvm安装macos附加上一个win"&gt;kvm安装macos附加上一个win
&lt;/h4&gt;&lt;p&gt;查看这里：&lt;a class="link" href="https://dev.leiyanhui.com/kvm/macos_add_win10/" target="_blank" rel="noopener"
&gt;https://dev.leiyanhui.com/kvm/macos_add_win10/&lt;/a&gt;&lt;/p&gt;</description></item></channel></rss>